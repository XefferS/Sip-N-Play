<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2. Rész - A feladvány</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header class="page-header">Sip ’n’ Play Balaton Cup</header>
    
    <div id="gorilla-container" class="penalty-image-container">
        <img src="gorilla.jpeg" alt="Büntetés">
    </div>

    <main>
        <img src="1-8.png" alt="Feladvány ábrája" class="task-image">
        <p>Helyezd el a számokat 1-től 8-ig a körökben úgy, hogy a köröket összekötő vonalak mentén sehol se legyenek egymás után következő számok! (Pl. a 2 mellett sem az 1, sem a 3 nem lehet).</p>
        
        <input type="text" id="code-input" maxlength="4" placeholder="••••">
        <br>
        <button id="check-button" class="button">Ellenőrzés</button>

        <div class="message-area" id="error-message"></div>
        <div class="message-area" id="timer-message"></div>
    </main>

    <script>
        const correctCode = '7182';
        const lockoutTimeMs = 3 * 60 * 1000;

        const codeInput = document.getElementById('code-input');
        const checkButton = document.getElementById('check-button');
        const errorMessage = document.getElementById('error-message');
        const timerMessage = document.getElementById('timer-message');
        const gorillaContainer = document.getElementById('gorilla-container');

        let countdownInterval;

        function checkLockout() {
            const lockoutUntil = localStorage.getItem('lockoutUntil');
            if (!lockoutUntil) return;

            const remainingTime = lockoutUntil - Date.now();

            if (remainingTime > 0) {
                disableInputsAndShowGorilla();
                startCountdown(remainingTime);
            } else {
                clearLockout();
            }
        }
        
        function disableInputsAndShowGorilla() {
            codeInput.disabled = true;
            checkButton.disabled = true;
            gorillaContainer.style.display = 'flex'; // Gorilla mutatása
        }

        function setLockout() {
            const lockoutUntil = Date.now() + lockoutTimeMs;
            localStorage.setItem('lockoutUntil', lockoutUntil);
            disableInputsAndShowGorilla();
            startCountdown(lockoutTimeMs);
        }

        function clearLockout() {
            localStorage.removeItem('lockoutUntil');
            codeInput.disabled = false;
            checkButton.disabled = false;
            gorillaContainer.style.display = 'none'; // Gorilla elrejtése
            clearInterval(countdownInterval);
            timerMessage.textContent = '';
            errorMessage.textContent = 'Lejárt a büntetés, próbáld újra!';
            codeInput.value = '';
            codeInput.focus();
        }
        
        function startCountdown(duration) {
            let remaining = Math.ceil(duration / 1000);
            
            countdownInterval = setInterval(() => {
                const minutes = Math.floor(remaining / 60);
                const seconds = remaining % 60;
                timerMessage.textContent = `Próbálkozz újra ${minutes}:${seconds.toString().padStart(2, '0')} múlva.`;
                remaining--;
                if (remaining < 0) clearLockout();
            }, 1000);
        }

        checkButton.addEventListener('click', () => {
            errorMessage.textContent = '';
            if (codeInput.value === correctCode) {
                localStorage.removeItem('lockoutUntil');
                window.location.href = 'feladat.html';
            } else {
                errorMessage.textContent = 'Sikertelen próbálkozás!';
                setLockout();
            }
        });
        
        checkLockout();
    </script>
</body>
</html>